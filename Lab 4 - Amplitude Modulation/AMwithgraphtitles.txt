clc
clear
%Signal=audioread('C:\Users\Jawad-PC\Desktop\Song1.wav');
%ToSend=Signal(5000:5300);
ToSend=[0.387939453125000,0.416046142578125,0.457397460937500,0.496826171875000,0.533630371093750,0.537963867187500,0.509124755859375,0.489044189453125,0.457611083984375,0.439910888671875,0.459930419921875,0.470977783203125,0.486785888671875,0.511505126953125,0.527770996093750,0.557403564453125,0.582702636718750,0.588165283203125,0.586700439453125,0.577514648437500,0.553497314453125,0.519042968750000,0.495239257812500,0.457244873046875,0.399108886718750,0.388153076171875,0.411132812500000,0.406219482421875,0.387420654296875,0.391693115234375,0.413909912109375,0.418884277343750,0.403320312500000,0.373229980468750,0.323364257812500,0.281677246093750,0.268371582031250,0.272735595703125,0.257019042968750,0.215850830078125,0.208160400390625,0.208526611328125,0.187774658203125,0.208251953125000,0.239532470703125,0.239562988281250,0.257629394531250,0.299224853515625,0.329864501953125,0.335052490234375,0.344390869140625,0.365722656250000,0.353881835937500,0.345947265625000,0.376953125000000,0.395751953125000,0.409484863281250,0.423767089843750,0.395294189453125,0.371398925781250,0.409637451171875,0.434173583984375,0.408416748046875,0.415985107421875,0.441345214843750,0.440948486328125,0.458190917968750,0.447540283203125,0.389343261718750,0.361297607421875,0.351196289062500,0.343902587890625,0.363281250000000,0.411468505859375,0.483215332031250,0.539184570312500,0.584838867187500,0.618011474609375,0.594573974609375,0.568481445312500,0.550750732421875,0.491912841796875,0.428283691406250,0.382720947265625,0.356903076171875,0.339965820312500,0.317382812500000,0.327331542968750,0.355957031250000,0.372833251953125,0.377777099609375,0.358093261718750,0.342071533203125,0.334411621093750,0.336700439453125,0.371002197265625,0.371795654296875,0.320159912109375,0.285186767578125,0.293640136718750,0.340759277343750,0.393768310546875,0.410034179687500,0.375488281250000,0.336212158203125,0.342468261718750,0.354003906250000,0.353057861328125,0.368072509765625,0.411804199218750,0.452575683593750,0.400299072265625,0.352478027343750,0.447570800781250,0.539215087890625,0.560913085937500,0.601257324218750,0.617950439453125,0.592132568359375,0.592193603515625,0.613464355468750,0.590332031250000,0.534271240234375,0.486267089843750,0.437713623046875,0.420928955078125,0.411163330078125,0.376708984375000,0.381469726562500,0.403442382812500,0.438140869140625,0.472137451171875,0.455505371093750,0.484893798828125,0.501098632812500,0.454315185546875,0.514038085937500,0.578125000000000,0.529418945312500,0.489440917968750,0.477722167968750,0.450256347656250,0.380218505859375,0.307769775390625,0.264038085937500,0.214752197265625,0.210571289062500,0.226013183593750,0.222778320312500,0.237518310546875,0.274139404296875,0.410095214843750,0.548675537109375,0.531890869140625,0.455261230468750,0.395446777343750,0.427124023437500,0.501739501953125,0.499664306640625,0.533966064453125,0.524688720703125,0.400451660156250,0.399322509765625,0.548034667968750,0.548736572265625,0.221832275390625,0.0759277343750000,0.331756591796875,0.332214355468750,0.252410888671875,0.391540527343750,0.318359375000000,0.417236328125000,0.712799072265625,0.549560546875000,0.367065429687500,0.439971923828125,0.400512695312500,0.311859130859375,0.233856201171875,0.163391113281250,0.0952758789062500,0.0418090820312500,0.214202880859375,0.417175292968750,0.288208007812500,0.0871887207031250,0.237243652343750,0.504211425781250,0.448089599609375,0.321380615234375,0.335327148437500,0.284973144531250,0.342376708984375,0.517761230468750,0.489562988281250,0.314483642578125,0.181640625000000,0.205688476562500,0.279632568359375,0.207702636718750,0.174652099609375,0.256317138671875,0.278564453125000,0.275482177734375,0.335784912109375,0.388458251953125,0.308441162109375,0.237274169921875,0.284790039062500,0.222900390625000,0.135284423828125,0.182342529296875,0.202606201171875,0.225311279296875,0.247741699218750,0.199371337890625,0.212188720703125,0.246765136718750,0.208679199218750,0.151336669921875,0.159973144531250,0.279418945312500,0.380096435546875,0.354156494140625,0.235168457031250,0.212127685546875,0.335845947265625,0.197418212890625,0,0.303344726562500,0.494720458984375,0.204437255859375,0.125549316406250,0.333343505859375,0.458679199218750,0.480072021484375,0.507904052734375,0.638214111328125,0.604278564453125,0.333343505859375,0.346282958984375,0.602630615234375,0.664337158203125,0.626342773437500,0.569000244140625,0.471801757812500,0.581909179687500,0.864318847656250,0.991088867187500,0.936676025390625,0.832916259765625,0.647125244140625,0.408416748046875,0.305755615234375,0.299468994140625,0.260253906250000,0.336975097656250,0.429382324218750,0.319091796875000,0.323638916015625,0.506500244140625,0.525848388671875,0.497833251953125,0.517822265625000,0.421417236328125,0.310729980468750,0.322967529296875,0.429199218750000,0.453521728515625,0.312377929687500,0.278564453125000,0.354400634765625,0.319396972656250,0.354095458984375,0.455474853515625,0.405944824218750,0.373382568359375,0.461334228515625,0.593353271484375,0.749206542968750,0.723663330078125,0.491027832031250,0.381408691406250,0.429290771484375,0.433563232421875,0.456390380859375,0.658569335937500,0.916046142578125,0.925689697265625,0.666076660156250,0.407745361328125,0.393127441406250,0.636749267578125,0.788391113281250,0.656890869140625,0.553985595703125,0.560302734375000,0.527923583984375,0.548431396484375,0.610656738281250];
LengthOfSignal=100;
TotalTime=length(ToSend);
figure;
subplot(4,1,1)
plot(ToSend(1:LengthOfSignal));
title('Message')
MinLevel=min(ToSend);
DC=abs(MinLevel);
ToSend=ToSend+DC;
grid on;
subplot(4,1,2)
plot(ToSend(1:LengthOfSignal));
title('Elevated Message')
%Modulating Signal Generation
Wam=1000;
t=0:0.01:TotalTime*0.01;
M_Signal=sin(Wam*t);
subplot(4,1,3)
plot(M_Signal(1:LengthOfSignal));
title('Career')
subplot(4,1,4)
plot(M_Signal(1:LengthOfSignal).*ToSend(1:LengthOfSignal));
title('Modulated Signal')
%%demodulation
figure;
subplot(4,1,1)
sentsignal=M_Signal(1:LengthOfSignal).*ToSend(1:LengthOfSignal);
for i=1:LengthOfSignal
    if sentsignal(i)<0
        sentsignal(i)=0;
    end
end
%positive part
plot(sentsignal);
title('Modulated Signals Positive Side')
%unrepalling
Averager = 7
for i=1:(LengthOfSignal-Averager)
        sentsignal(i)=sum(sentsignal(i:i+Averager-1))/Averager;
end
subplot(4,1,2)
plot(sentsignal);
title('Signal after Low Pass Filter')
%amplified comparison
subplot(4,1,3)
plot(3*sentsignal);
hold on;
plot(ToSend(1:LengthOfSignal),'b');
title('Comparison with Input Signal')
%Error graph
subplot(4,1,4)
plot(ToSend(1:LengthOfSignal)-3*sentsignal)
title('Noise Elements')